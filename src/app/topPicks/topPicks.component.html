<div class="container-fluid mb-5">
  <div class="mt-3">
    <div *ngIf="indexSummary$ | async as summary" class="horizontal-scroll row mx-1 mb-4">
      <!-- {{ summary.IWC.trend_note }} -->
      <div class="px-1 scroll-container">
        <div class="shadow-sm summary-card p-3 card-7">
          <p class="font-weight-bold">Large CAP</p>
          <app-single-quote-widget symbol="IWC" exchange="AMEX" width="250"></app-single-quote-widget>
          <p class="align-items-center d-flex font-weight-bold justify-content-between">
            {{ summary.IWC.trend_note }}
            <i
              triggers="mouseenter:mouseleave"
              placement="bottom"
              [ngbPopover]="popContentA"
              class="fa fa-info-circle"
            ></i>
          </p>
          <ng-template #popContentA>
            <div *ngFor="let note of summary.IWC.notes">
              <div class="mb-2 text-wrap">{{ note }}</div>
            </div>
          </ng-template>
        </div>
      </div>
      <div class="px-1 scroll-container">
        <div class="shadow-sm summary-card p-3 card-7">
          <p class="font-weight-bold">Mid CAP</p>
          <app-single-quote-widget symbol="IWM" exchange="AMEX" width="250"></app-single-quote-widget>
          <p class="align-items-center d-flex font-weight-bold justify-content-between">
            {{ summary.IWM.trend_note }}
            <i
              triggers="mouseenter:mouseleave"
              placement="bottom"
              [ngbPopover]="popContentB"
              class="fa fa-info-circle"
            ></i>
          </p>
          <ng-template #popContentB>
            <div *ngFor="let note of summary.IWM.notes">
              <div class="mb-2 text-wrap">{{ note }}</div>
            </div>
          </ng-template>
        </div>
      </div>
      <div class="px-1 scroll-container">
        <div class="shadow-sm summary-card p-3 card-7">
          <p class="font-weight-bold">Small CAP</p>
          <app-single-quote-widget symbol="MDY" exchange="AMEX" width="250"></app-single-quote-widget>
          <p class="align-items-center d-flex font-weight-bold justify-content-between">
            {{ summary.MDY.trend_note }}
            <i
              triggers="mouseenter:mouseleave"
              placement="bottom"
              [ngbPopover]="popContentC"
              class="fa fa-info-circle"
            ></i>
          </p>
          <ng-template #popContentC>
            <div *ngFor="let note of summary.MDY.notes">
              <div class="mb-2 text-wrap">{{ note }}</div>
            </div>
          </ng-template>
        </div>
      </div>
      <div class="px-1 scroll-container">
        <div class="shadow-sm summary-card p-3 card-7">
          <p class="font-weight-bold">Micro CAP</p>
          <app-single-quote-widget symbol="SPY" exchange="AMEX" width="250"></app-single-quote-widget>
          <p class="align-items-center d-flex font-weight-bold justify-content-between">
            {{ summary.SPY.trend_note }}
            <i
              triggers="mouseenter:mouseleave"
              placement="bottom"
              [ngbPopover]="popContentD"
              class="fa fa-info-circle"
            ></i>
          </p>
          <ng-template #popContentD>
            <div *ngFor="let note of summary.SPY.notes">
              <div class="mb-2 text-wrap">{{ note }}</div>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
    <div *ngIf="indexSummary$ | async as summary" class="horizontal-scroll row mx-1 mb-4">
      <div class="px-1 scroll-container">
        <div class="shadow-sm summary-card p-3 card-7">
          <p class="font-weight-bold">Fear Index</p>
          <app-single-quote-widget symbol="VXX" exchange="AMEX" width="250"></app-single-quote-widget>
          <p class="align-items-center d-flex font-weight-bold justify-content-between">
            {{ summary.VXX.trend_note }}
            <i
              triggers="mouseenter:mouseleave"
              placement="bottom"
              [ngbPopover]="popContentE"
              class="fa fa-info-circle"
            ></i>
          </p>
          <ng-template #popContentE>
            <div *ngFor="let note of summary.VXX.notes">
              <div class="mb-2 text-wrap">{{ note }}</div>
            </div>
          </ng-template>
        </div>
      </div>
      <div class="px-1 scroll-container">
        <div class="shadow-sm summary-card p-3 card-7">
          <p class="font-weight-bold">Short term trend</p>
          <app-single-quote-widget symbol="TRIN" exchange="NYSE" width="250"></app-single-quote-widget>
          <p class="align-items-center d-flex font-weight-bold justify-content-between">
            &nbsp;
            <i
              triggers="mouseenter:mouseleave"
              placement="bottom"
              [ngbPopover]="popContentF"
              class="fa fa-info-circle"
            ></i>
          </p>

          <ng-template #popContentF
            ><div class="mb-2 text-wrap">
              1. A value of 0.50 may indicate an overbought market and that bullish sentiment is overheating.
            </div>
            <div class="mb-2 text-wrap">2. Overall market is bullish if the value is < 1.</div>
            <div class="mb-2 text-wrap">3. Overall market is neutral if the value is = 1.</div>
            <div class="mb-2 text-wrap">4. Overall market is (getting to )bearish if the value is > 1.</div>
            <div class="mb-2 text-wrap">
              5. A value that exceeds 3.00 indicates an oversold market and that bearish sentiment is too dramatic. This
              could mean an upward reversal is coming.
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
  <div class="mb-5" id="nav-tabContent">
    <!-- Top Picks-->
    <div class="tab-pane fade show card" id="nav-topStocks" role="tabpanel" aria-labelledby="nav-topStocks-tab">
      <div *ngIf="topStocks$ | async as topStocks">
        <div *ngIf="hasConfidenceScore">
          <div class="py-3">
            <ul class="mb-0">
              <li>Stocks in confirmed uptrend and at a good buy point.</li>
              <li>Click on the symbol to get more detailed analysis about the stock.</li>
              <li>Click on the industry to see more detailed analysis about the industry and all the stocks in it.</li>
              <li>Click <a href="/uptrendingStocks">here to See All the stocks in Uptrend.</a></li>
            </ul>
          </div>
          <div class="table-container">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th class="text-center" scope="col">Company</th>
                  <th class="text-center" scope="col">Symbol</th>
                  <th class="text-center" scope="col">
                    <a href="https://www.investopedia.com/terms/i/industry.asp" target="_blank">Industry</a>
                    <i class="fa fa-info-circle" title="Industry of a stock" aria-hidden="true"></i>
                  </th>
                  <th class="text-center" scope="col">Price</th>
                  <th class="text-center" scope="col">Gain/Loss</th>
                  <th class="text-center" scope="col">Confidence Score</th>
                  <th class="text-center" scope="col">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let topStock of topStocks" class="table-row">
                  <td class="text-center company-name">
                    {{ topStock.companyName | uppercase }}
                  </td>
                  <td class="text-center">
                    <a href="/symbolDetails/{{ topStock.symbol }}">{{ topStock.symbol }}</a>
                  </td>
                  <td class="text-center" style="word-wrap: break-word; min-width: 160px; max-width: 160px">
                    <div *ngIf="topStock.industry">
                      <a *ngIf="topStock.industryId" href="/subSectorDetails/{{ topStock.industryId }}">
                        {{ topStock.industry }}
                      </a>
                      <div *ngIf="!topStock.industryId" class="industry">
                        {{ topStock.industry }}
                      </div>
                    </div>
                    <div *ngIf="!topStock.industry">N/A</div>
                  </td>
                  <td class="text-center">
                    <i class="fas fa-arrow-up"></i>
                    {{ topStock.price }}
                  </td>
                  <td
                    *ngIf="topStock.gain_flag == 1; then gain; else (topStock.gain_flag == 0 && loss) || noDataDiv"
                  ></td>
                  <td class="text-center" *ngIf="topStock.confidence; else noDataDiv">{{ topStock.confidence }}</td>
                  <td class="text-center">
                    <div class="action-btn-group">
                      <button
                        class="btn btn-primary mb-2"
                        fragment="myportfolio"
                        type="button"
                        (click)="navigateToSection('myportfolio')"
                      >
                        Add to Open positions
                      </button>
                      <button type="button" (click)="addToFavorites(topStock.symbol)" class="btn btn-secondary mb-2">
                        Add to Favorites
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div *ngIf="!hasConfidenceScore">
          <div class="py-3">
            <ul class="mb-0">
              <li>Top stocks for the day. Click on the symbol to get more detailed analysis about the stock.</li>
            </ul>
          </div>
          <div class="table-container">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th width="380" class="text-center" scope="col">Company</th>
                  <!-- <th class="text-center" scope="col">Company</th> -->
                  <th class="text-center" scope="col">Trend</th>
                  <!-- <th class="text-center" scope="col">Price</th> -->
                  <!-- <th class="text-center" scope="col">Volume</th> -->
                  <th class="text-center" scope="col">
                    <div>
                      Dividend
                      <a href="https://www.investopedia.com/terms/d/dividendyield.asp" target="_blank">
                        <i class="fa fa-info-circle" title="Current Dividend Yield of the stock" aria-hidden="true"></i>
                      </a>
                    </div>
                  </th>
                  <th class="text-center" scope="col">
                    P/E
                    <a href="https://www.investopedia.com/terms/p/price-earningsratio.asp" target="_blank">
                      <i class="fa fa-info-circle" title="Current P/E ratio of the stock" aria-hidden="true"></i>
                    </a>
                  </th>
                  <th class="text-center" scope="col">Market Cap</th>
                  <th class="text-center" scope="col">
                    Industry
                    <a href="https://www.investopedia.com/terms/i/industry.asp" target="_blank">
                      <i class="fa fa-info-circle" title="Industry of a stock" aria-hidden="true"></i>
                    </a>
                  </th>
                  <th class="text-center" scope="col">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let topStock of topStocks" class="table-row">
                  <!-- <td class="text-left company-name">
                    <a class="symbol" href="/symbolDetails/{{ topStock.symbol }}">{{ topStock.symbol }}</a>
                    <br />
                    {{ topStock.companyName | truncate: 40 | uppercase }}
                  </td> -->
                  <td>
                    <app-single-quote-widget
                      [symbol]="topStock.symbol"
                      [exchange]="topStock.exchange"
                    ></app-single-quote-widget>
                  </td>
                  <td class="text-left">
                    {{ topStock.symbol }}
                    <div *ngIf="topStock.trend == 1">
                      <i class="fas fa-arrow-up"></i>
                      <span class="trend">Uptrend</span>
                    </div>
                    <div *ngIf="topStock.trend == -1">
                      <i class="fas fa-arrow-down"></i>
                      <span class="trend">Downtrend</span>
                    </div>
                    <div *ngIf="topStock.trend == 0">
                      <i class="fas fa-arrow-right"></i>
                      <span class="trend">Neutral</span>
                    </div>
                    <!-- <app-view-trend-details [symbol]="topStock.symbol"></app-view-trend-details> -->
                  </td>
                  <!-- <td class="text-right price">
                    {{ topStock.price | currency }}
                    !-- <div *ngIf="topStock.bestBuy === 1">
                      <span class="badge badge-pill my-1 badge-primary info-badge">
                        <i class="far fa-flag" aria-hidden="true"></i> &nbsp;Bestbuy
                      </span>
                    </div> ---
                  </td> -->
                  <!-- <td class="text-right volume">
                    {{ topStock.volume | number }}
                  </td> -->
                  <td class="text-right dividend">
                    <span *ngIf="!topStock.dividendYield || topStock.dividendYield == '0'">-</span>
                    <span *ngIf="topStock.dividendYield != '0'">{{ topStock.dividendYield | percent: '1.0-2' }}</span>
                  </td>
                  <td class="text-right pe-ratio">
                    {{ topStock.peRatio | number: '1.0-2' }}
                  </td>
                  <td class="text-right">
                    {{ getPrunedValue(topStock.marketcap) }}
                  </td>
                  <td
                    class="text-left"
                    style="word-wrap: break-word; min-width: 160px; max-width: 160px; font-size: 14px"
                  >
                    <div *ngIf="topStock.industry">
                      <a
                        *ngIf="topStock.industryId"
                        class="industry"
                        href="/subSectorDetails/{{ topStock.industryId }}"
                      >
                        {{ topStock.industry }}
                      </a>
                      <div *ngIf="!topStock.industryId" class="industry">
                        {{ topStock.industry }}
                      </div>
                      <div *ngFor="let industryBadge of topStock.industryBadgeList">
                        <span class="badge badge-pill my-1 badge-info info-badge pill-wrap">{{ industryBadge }}</span>
                      </div>
                    </div>
                    <div *ngIf="!topStock.industry">N/A</div>
                  </td>
                  <td class="text-left note">
                    <div class="action-btn-group" *ngIf="!isFavorite(topStock.symbol)">
                      <a
                        href="javascript:void(0);"
                        (click)="addToFavorites(topStock.symbol)"
                        class="btn-pading text-btn"
                      >
                        Add to Favorites
                      </a>
                    </div>
                    <div class="action-btn-group" *ngIf="isFavorite(topStock.symbol)">
                      <a
                        href="javascript:void(0);"
                        (click)="removeFromFavorites(topStock.symbol)"
                        class="btn-pading text-btn"
                      >
                        Delete from Favorites
                      </a>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="text-right p-2">
          <button type="button" (click)="viewAllUptrendingStocks()" class="btn btn-orange">View More</button>
        </div>
      </div>
    </div>
  </div>

  <h2 *ngIf="isTopIndustry">Top Industry</h2>
  <div *ngIf="topIndustry$ | async as industryList" class="row mt-3">
    <div class="card pb-3 mb-4 border-0 col-12 col-md-3 col-sm-6 col-lg-3" *ngFor="let industry of industryList">
      <div class="card-body shadow">
        <b>{{ industry.title }}</b>
        <p class="card-text note line-clamp-3">
          Change: {{ industry.change }} <br />
          Perf Month: {{ industry.perf_month }}
        </p>
        <div>
          <a href="javascript:void(0);" class="float-left" (click)="viewIndustryDetails(industry.id)">View</a>
        </div>
      </div>
    </div>
  </div>

  <ng-template #noDataDiv>
    <div class="text-center my-5">
      <a href="/uploadPortfolio">Upload transactions</a> so we can compute this value. You are 1-step away from it.
    </div>
  </ng-template>
  <ng-template #gain>
    <div class="text-center">
      <img class="card-img-top" src="assets/gain.png" style="height: 40px; width: 40px" alt="Card image cap" />
    </div>
  </ng-template>
  <ng-template #confused>
    <div class="text-center">
      <img class="card-img-top" src="assets/confused.png" style="height: 40px; width: 40px" alt="Card image cap" />
    </div>
  </ng-template>
  <ng-template #loss>
    <div class="text-center">
      <img class="card-img-top" src="assets/loss.png" style="height: 40px; width: 40px" alt="Card image cap" />
    </div>
  </ng-template>
</div>
