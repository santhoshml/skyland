<div class="container">
    <div class="p-3 mb-2 bg-warning text-dark text-center" *ngIf="!userProfile">
        We donot have a model built for you yet, so you cannot find any stocks matching your trading style (with a Matching score)
    </div>    
    <div class="tradingview-widget-container" id="symbolInfoWidget">
        <div class="tradingview-widget-container__widget"></div>
    </div>
    <div class="btn-group mt-3 mb-3">
        <div class="dropdown show ml-2">
            <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Buy with your trading platform
            </a>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
              <a class="dropdown-item" href="https://schwab.com" target="_blank">Schwab</a>
              <a class="dropdown-item" href="https://etrade.com" target="_blank">E-Trade</a>
              <a class="dropdown-item" href="https://webtrading.tradestation.com" target="_blank">Trade Station</a>
              <a class="dropdown-item" href="https://ndcdyn.interactivebrokers.com/sso/Login?RL=1" target="_blank">Interactive Brokers</a>
            </div>
          </div>
            <button *ngIf="!isFavorite" type="button" class="ml-2 btn btn-secondary" (click)="addToFavorites()">
                <i class="fas fa-heart"></i>
                Add to Favorite List & track everyday
            </button>
            <button *ngIf="isFavorite" type="button" class="ml-2 btn btn-secondary" (click)="removeFromFavorites()">
                <i class="far fa-heart"></i>
                Remove from Favorite List
            </button>            
            <button type="button" class="ml-2 btn btn-secondary" (click)="open(mymodal)">
                <i class="fas fa-sticky-note"></i>
                Add Notes
                </button>
    </div>
    <div *ngIf="symbolDetailsResp$ | async as symbolDetailsResp" class="mb-3">
        <div class="card-group">
            <div *ngIf="symbolDetailsResp.gain_flag === 1 && symbolDetailsResp.confidence >= 0.75" class="card ml-2">
                <img class="card-img-top" src="assets/gain.png" style="height: 150px;" alt="Card image cap">
                <div class="card-body mb-5">
                    <h5 class="card-title p-3">Prediction - GAIN</h5>
                    <div class="card-text text-muted p-3">
                        Based on your historical trades and current market behaviour of {{symbolDetailsResp.symbol}}, if you go long, you will make money.
                    </div>
                </div>
                <div class="card-footer text-muted">
                    <small>**based on the analysis after the market close on {{symbolDetailsResp.date}}</small>
                </div>
            </div>
            <div *ngIf="symbolDetailsResp.gain_flag === 1 && symbolDetailsResp.confidence <= 0.75" class="card ml-2">
                <img class="card-img-top" src="assets/confused.png" style="height: 150px;" alt="Card image cap">
                <div class="card-body mb-5">
                    <h5 class="card-title p-3">Prediction - Neutral/Confused</h5>
                    <div class="card-text text-muted p-3">
                        Based on your historical trades and current market behaviour of {{symbolDetailsResp.symbol}}, if you go long, you will make money.
                    </div>
                </div>
                <div class="card-footer text-muted">
                    <small>**based on the analysis after the market close on {{symbolDetailsResp.date}}</small>
                </div>
            </div>
            <div *ngIf="symbolDetailsResp.gain_flag === 0" class="card">
                <img class="card-img-top" src="assets/loss.png" style="height: 150px;" alt="Card image cap">
                <div class="card-body mb-5">
                    <h5 class="card-title p-3">Prediction - LOSS</h5>
                    <div class="card-text text-muted p-3">
                            Based on your historical trades and current market behaviour of {{symbolDetailsResp.symbol}}, this is not a good time to buy {{symbolDetailsResp.symbol}}.
                    </div>
                </div>
                <div class="card-footer text-muted">
                    <small>**based on the analysis after the market close on {{symbolDetailsResp.date}}</small>
                </div>
            </div>
            <div class="card ml-2 mr-2">
                <table style="height: 150px;">
                    <tbody>
                        <tr>
                            <td class="text-center align-middle h1">{{symbolDetailsResp.confidence | percent: '1.0-2'}}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="card-body mb-5">
                    <h5 class="card-title p-3">Matching Score</h5>
                    <!-- <h1 class="card-subtitle text-center mt-3 mb-3 p-3">{{symbolDetailsResp.confidence | percent: '1.0-2'}}</h1> -->
                    <p class="card-text p-3 text-muted">Percent match of {{symbolDetailsResp.symbol}}'s today pattern with your past succesful transactions</p>
                </div>
                <div class="card-footer text-muted">
                    <small>**based on the analysis after the market close on {{symbolDetailsResp.date}}</small>
                </div>
            </div>
        </div>
    </div>
    <div class="mt-5">
        <hr>
        <div class="mb-2">
            <label class="h5">Technical / Fundamental Features for this Symbol</label>
        </div>
        <div class="card-group" *ngIf="symbolDetailsResp$ | async as symbolDetailsResp">
            <div class="card" style="max-width: 20%;">
                <div class="card-body">
                    <h6 class="p-2 mb-3 card-title text-center">Price/Volume</h6>
                    <ng-container *ngFor="let tag of getArray(symbolDetailsResp.tags)">
                        <div class="card-text m-2 text-center" *ngIf="isExistsInPriceVol(tag)">
                            <a role="button" (click)="gotoTagLink(tag)" [ngClass]="getClassForPills(tag)">
                                {{ getTagDisplayText(tag) }}
                            </a>
                        </div>
                    </ng-container>
                </div>
            </div>
            <div class="card" style="max-width: 20%;">
                <div class="card-body">
                    <h6 class="card-title mb-3 text-center p-2">Classification</h6>
                    <ng-container *ngFor="let tag of getArray(symbolDetailsResp.tags)">
                        <div class="card-text m-2 text-center" *ngIf="isExistsInClassification(tag)">
                            <a role="button" (click)="gotoTagLink(tag)" [ngClass]="getClassForPills(tag)">
                                {{ getTagDisplayText(tag) }}
                            </a>
                        </div>
                    </ng-container>
                </div>
            </div>
            <div class="card" style="max-width: 80%;">
                <div class="card-body mb-5">
                    <h6 class="m-2 card-title text-center">Technical</h6>
                    <ng-container *ngFor="let tag of getArray(symbolDetailsResp.tags)">
                        <span class="card-text m-2 text-center" *ngIf="isExistsInTechnical(tag)">
                            <a role="button" (click)="gotoTagLink(tag)" [ngClass]="getClassForPills(tag)">
                                {{ getTagDisplayText(tag) }}
                            </a>
                        </span>
                    </ng-container>
                </div>
            </div>
        </div>
        <div >
            <small class="text-muted">** Highlighted features where user showed substantial gains in the past </small>
        </div>
    </div>
    <div class="mt-3 col-md-12 col-lg-12">
        <div id="tradingview_73abe"></div>
    </div>
</div>

<ng-template #mymodal let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Comments for {{activeSymbol}}</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">Ã—</span>
      </button>
    </div>
    <div class="modal-body">
        <textarea class="form-control" rows="5" [(ngModel)]="userNotes" type="text"  placeholder="Add notes here ..."></textarea>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Update</button>
    </div>
  </ng-template>